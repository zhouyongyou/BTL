# Top Referrer Leaderboard Design

This document proposes a design for implementing a real-time leaderboard that tracks the most successful referrers based on the total ETH they bring into the system.

## Goals
- Automatically calculate how much ETH each referrer has generated.
- Display the top 10 referrer addresses along with the number of invited users and the total ETH amount.
- Update the leaderboard whenever a new deposit occurs.
- Optional daily or weekly reset/snapshot of the rankings.

## On-Chain Changes
To reliably record referral information, the deposit contract should emit an event whenever a referral occurs. A suggested event structure:

```solidity
// Inside BTLDeposit.sol
event ReferralDeposit(address indexed referrer, address indexed user, uint256 amount);
```

Emit this event at the point where the referral bonus is applied in `depositBTL`.

## Off-Chain Tracking
1. **Event Listener**
   - Use a backend service (Node.js) that listens for `ReferralDeposit` events via Web3 or an indexed service (e.g., The Graph).
   - When an event is received, update a database record storing cumulative `referralCount` and `referralETH` for each referrer address.
2. **Leaderboard Query**
   - Expose an API endpoint that returns the top 10 referrers sorted by total ETH or referral count.
   - The DApp fetches this data periodically and updates the UI.
3. **Reset/Snapshot**
   - Implement a scheduled job that either clears the stored counters or writes them to a history table to create snapshots for daily/weekly rankings.

## UI Integration
- Add a new section on the webpage that lists the ranking:
  1. Referrer address (shortened)
  2. Number of users referred
  3. Total ETH generated by referrals
- The UI queries the backend endpoint every few minutes (or listens to WebSocket updates) to keep the display current.

This approach avoids the need for heavy on-chain calculations and leverages off-chain indexing for fast updates.
